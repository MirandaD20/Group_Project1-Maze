#Notes for Setup:
# Connect to Bitmap Display and set parameters to:
# Unit height and width: 8
# Display height and width: 512 x 512
# Walls are 0s, Paths are 1s, Keys are 35, 43, 72, and Doors are 44 and 73


.data

# Maze: 64x64 tiles
mazeDisplay: .space 0x100000
##################################################################################################################################################################
# 						ARRAY FOR MAZE
##################################################################################################################################################################
maze: .word 
	1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
	1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
	1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
	1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,
	1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	0,0,0,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,0,0,0,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,0,0,0,0,1,1,1,0,1,1,1,1,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,73,73,73,73,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,35,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,0,0,0,
	1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,43,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,73,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,73,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,72,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,
	1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,73,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,
	1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,
	1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
	1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
	1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,44,44,44,44,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,44,44,44,44

#######################################################################################################################################################################
#								ARRAY FOR MAZE																   #
#######################################################################################################################################################################


# Colors for the maze
pathColor: .word 0x00191970 # Midnight Blue
wallColor: .word 0x00FFFFFF # White
keyColor: .word 0x00FFFF00 # Yellow
doorColor: .word 0x0000FFFF # Cyan

# Player info
playerX:      .word 1           # starting tile X
playerY:      .word 8           # starting tile Y
playerColor:  .word 0x00FF0000      # Red

#Array to represent collected keys
collected: .word 0, 0, 0

# Message displayed when specific conditions are met
noKeyFoundMsg: .asciiz "You don't have the key to unlock this door! Putting you back at the start...."

outOfBoundsMsg: .asciiz "You're out of bounds. Game over!"

winMsg: .asciiz "You've successfully escaped the maze!"

.text
.globl main

main:
    #paint in the maze
    jal paintMaze
    
    # Initialize player coordinates
    lw $s0, playerX
    lw $s1, playerY
   
    # Initialize player direction
    li $s7, 1
   

mainLoop:
# -------------------------
# Clear player tile (8x8)		
# -------------------------
clearPixel:
    li $t0, 0x10010000        # Base address of pixel display
    sll $t1, $s1, 6		#y * 64
    add $t1, $t1, $s0         # index = y*64 + x
    sll $t1, $t1, 2           # *4 for offset
    add $t0, $t0, $t1         # t0 = address of pixel
    lw $t2, pathColor
    sw $t2, 0($t0)            # write color
     
    jal getKeyInput
    move $a0, $v0
    

    j movePlayer

# -------------------------
# Move player
# -------------------------
movePlayer:
 
    # Check which direction the player is moving in
    beq $s7, 1, moveUp
    beq $s7, 2, moveDown
    beq $s7, 3, moveLeft
    beq $s7, 4, moveRight


moveUp:
    addi $s1, $s1, -1
    j checkMove
moveDown:
    addi $s1, $s1, 1
    j checkMove
moveLeft:
    addi $s0, $s0, -1
    j checkMove
moveRight:
    addi $s0, $s0, 1
    j checkMove

checkMove:
    # Bounds check
    bltz $s0, outOfBounds
    bltz $s1, outOfBounds
    bge $s0, 64, outOfBounds
    bge $s1, 64, outOfBounds
 
    # Calculate maze index
    sll $t5, $s1, 6
    add $t5, $t5, $s0
    sll $t5, $t5, 2
    li $s6, 0x10010000
    add $s6, $s6, $t5
    lw $t7, 0($s6)        		

    # Wall check
    la $t8, maze
    add $t8, $t5, $t8
    lw $t9, 0($t8)
    beq $t9, 0, outOfBounds #If the player has collided with a wall, end the game
    move $a3, $t9	#In case there is a door
    
    # If there is a door, try to unlock
    beq $t9, 36, tryUnlock
    beq $t9, 44, tryUnlock
    beq $t9, 73, tryUnlock
    
    #Check if there is a key
    # Keys (arbitrary codes)
    li $s4, 35
    beq $t9, $s4, collectKey
    li $s4, 43
    beq $t9, $s4, collectKey
    li $s4, 72
    beq $t9, $s4, collectKey

# Updates the player's coordinates
updatePlayer:
    sw $s0, playerX	
    sw $s1, playerY
    lw $t0, playerColor
    sw $t0, 0($s6)
    
# Controls player speed
    li   $a0, 150
    li   $v0, 32
    syscall
    
    j mainLoop

resetPlayer:
    addi $s1, $s1, 1 #shift the player
    j updatePlayer


collectKey:
    la $t0, collected	
    li $t1, 0	#index used to search through collected array
    li $t5, 1
    sw $t5, 0($t8) # key disappears from the maze

#find an empty index in the collected array
findEmpty:
    lw $t2, 0($t0)
    beqz $t2, addKey 
    addi $t0, $t0, 4
    addi $t1, $t1, 1
    blt $t1, 3, findEmpty
    
addKey:
    sw $t9, 0($t0)        # store key
    j updatePlayer

# complete the current movement and go back to the main loop
doneMove:
    j mainLoop

# triggered when the player moves outside the border or hits a wall
outOfBounds:
    li $v0, 55
    la $a0, outOfBoundsMsg
    li $a1, 1
    syscall

    li $v0, 10
    syscall

# -------------------------
# WASD Input
# -------------------------
  
getKeyInput:
    lw $t9, 0xFFFF0004	#keyboard MMIO
    li $t0, 119   # w
    li $t1, 97    # a
    li $t2, 115   # s
    li $t3, 100   # d


    beq $t9, $t0, inputUp
    beq $t9, $t1, inputLeft
    beq $t9, $t2, inputDown
    beq $t9, $t3, inputRight
 

inputUp:
    li $s7, 1
    j movePlayer
inputDown:
    li $s7, 2
    j movePlayer
inputLeft:
    li $s7, 3
    j movePlayer
inputRight:
    li $s7, 4
    j movePlayer



######################################################
#		painting the maze
######################################################
paintMaze:
	li $t0, 0 # Start at top left corner, y = 0
	la $t5, maze # load in the address of the maze
		
# Nested loop to paint cells
paintY:
	bge $t0, 64, return # After the last row is painted, return to where the procedure was called
	li $t1, 0 # Start from the left, x = 0
	sll $t2, $t0, 8 # Calculate row offset
	li $t3, 0x10010000 # Starting address
	add $t3, $t3, $t2 # Add row offset to the address, contains address of the pixel
	
paintX:
	bge $t1, 64, nextRow # Move to the next row when reaching the end of this one
	
	lw $t6, 0($t5) # Load in value from maze array to determine if the pixel is for a wall, path, key, or door
	beq $t6, 0, paintWall
	beq $t6, 1, paintPath
	
	# Paint in the doors
	beq $t6, 36, paintDoor
	beq $t6, 44, paintDoor
	beq $t6, 73, paintDoor
	
	#Paint in the keys
	beq $t6, 35, paintKey
	beq $t6, 43, paintKey
	beq $t6, 72, paintKey
	
	j paintX
	
paintWall:
	lw $t4, wallColor 
	sw $t4, 0($t3)	# Paint the pixel
	
	addi $t3, $t3, 4 # Increment the address to go to the next cell
	addi $t5, $t5, 4 # Increment the address to get the next value in the maze array
	addi $t1, $t1, 1 # Increment x
	j paintX
	
paintPath:
	lw $t4, pathColor
	sw $t4, 0($t3) # Paint pixel
	
	addi $t3, $t3, 4 # Increment the address to go to the next cell
	addi $t5, $t5, 4 # Increment the address to get the next value in the maze array
	addi $t1, $t1, 1 # Increment x
	j paintX

paintKey:
	lw $t4, keyColor
	sw $t4, 0($t3) # Paint pixel
	
	addi $t3, $t3, 4 # Increment the address to go to the next cell
	addi $t5, $t5, 4 # Increment the address to get the next value in the maze array
	addi $t1, $t1, 1 # Increment x
	j paintX

paintDoor:
	lw $t4, doorColor
	sw $t4, 0($t3) # Paint pixel
	
	addi $t3, $t3, 4 # Increment the address to go to the next cell
	addi $t5, $t5, 4 # Increment the address to get the next value in the maze array
	addi $t1, $t1, 1 # Increment x
	j paintX
	
nextRow:
	addi $t0, $t0, 1 # Increment y to go to the next row
	j paintY
return:
	jr $ra # Return to where the procedure was called 
	
	
###############################################################################################################################################
#						KEY/DOOR INTERACTION PROCEDURE										  
###############################################################################################################################################

# Code snippet to check if the player has the correct key in their 'collected' list

# Takes an argument $a3, which contains the value for the door
tryUnlock:
	move $t0, $a3 # Store door value in $t0
	addi $t0, $t0, -1 # Subtract one to get a key value
	la $t1, collected # Load in address of array with collected keys
	li $t6, 0 # maze array counter
	li $t7, 1 # Counter to see how many keys searched
	la $t8, maze
	

checkKeys:
	bgt $t7, 3, noKey
	lw $t2, 0($t1) #check keys in collected
	beq $t2, $t0, unlock
	addi $t1, $t1, 4 #increment collected array
	addi $t7, $t7, 1 # increment searched keys
	j checkKeys

# unlock the door by finding its values in the maze array and changing them to the path
unlock:
	beq $a3, 44, winGame
	bgt $t6, 4096, repaint # after going through the whole array, repaint the maze to show the opened door
	lw $t9, 0($t8)
	beq $t9, $a3, changeToPath # if the pixel is part of a door, change it to path
	addi $t8, $t8, 4 # increment maze address
	addi $t6, $t6, 1 # increment maze counter
	j unlock
	
changeToPath:
	li $t0, 1
	sw $t0, 0($t8)
	addi $t8, $t8, 4 # increment maze address
	addi $t6, $t6, 1 # increment maze counter
	j unlock
	
repaint:
	jal paintMaze
	
	j resetPlayer
	

# display a message to let the user know that they don't have a key for the door	
noKey:
	li $v0, 55
	la $a0, noKeyFoundMsg
	li $a1, 1
	syscall
	
	#restart player position
   	li $s0, 1
    	li $s1, 1
    	li $s7, 1
	j movePlayer
 
# Ends the game when the exit door is opened    	
winGame:
	li $v0, 55
	la $a0, winMsg
	li $a1, 1
	syscall
	
	li $v0, 10
        syscall
	

